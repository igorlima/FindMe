(function(c,e,a,b){var g=c.Lanche;var f=g.Compra=function(){};f.load=function(){b.title("Finalizando Pedido");b.showBtnVoltar(false);b.showMap(false);g.spinner.start();e("#phone-app").load("partials/compra.html",function(){d();b.configuration().online_fee&&g.spinner.stop()})};var d=function(){b.compra=a.observable({address:{city:"Lavras"}});g.User.loadLastAddress(function(i){var h=b.compra();h.address.street=i.street?i.street:"";h.address.number=i.number?i.number:"";h.address.district=i.district?i.district:"";b.compra(h)});b.onlineFee=a.computed(function(){return b.configuration().online_fee?parseFloat(b.configuration().online_fee):0});b.deliveryFee=a.computed(function(){return b.configuration().delivery_fee?parseFloat(b.configuration().delivery_fee):0});b.strOnlineFee=a.computed(function(){return"R$ "+b.onlineFee().toFixed(2)});b.strDeliveryFee=a.computed(function(){return"R$ "+b.deliveryFee().toFixed(2)});b.strTotalPedido=a.computed(function(){var h=b.totalPedido()+b.deliveryFee()+b.onlineFee();return"R$ "+h.toFixed(2)});b.checkout=function(){var h=b.compra();h.authenticity_token=g.User.data.authenticity_token;h.itens=[];b.pedido().itens().forEach(function(i){h.itens.push({id:i._id,qty:i.qte()})});g.spinner.start();e.post("/checkout",h,function(i){i=JSON.parse(i);var j=g.Util.message_errors(i.errors);j&&(alert(j));i.checkout_paypal_url&&(c.location.href=i.checkout_paypal_url);g.spinner.stop()})};a.applyBindings(b)};!function(){b.configuration=a.observable({});e.getJSON("/configuration",function(h){b.configuration(h);g.spinner.stop()})}()})(window,Zepto,ko,Lanche.viewModel);